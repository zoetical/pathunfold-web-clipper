# PathUnfold Web Clipper

A Chrome browser extension that allows you to clip web content (text, images, videos, audio) and post it directly to your Circle.so community spaces using the Headless Member API.

## Features

- 📎 **Clip Web Content**: Capture selected text, images, videos, and audio from any webpage
- 📝 **Rich Content Support**: Automatically formats content with HTML and supports media embedding
- 🔐 **Secure Authentication**: Uses JWT tokens generated by your backend server
- 🎯 **Easy Publishing**: Post clipped content directly to Circle spaces with one click
- ⚡ **Real-time Preview**: See how your post will look before publishing
- 🔄 **Auto-detection**: Intelligently detects images, videos, and audio on pages

## Installation

### For Development

1. Clone or download this repository
2. Open Chrome and navigate to `chrome://extensions/`
3. Enable "Developer mode" in the top right
4. Click "Load unpacked"
5. Select the `pathunfold-web-clipper` folder

### For Production

The extension will be available on the Chrome Web Store (coming soon).

## Setup Instructions

### 1. Backend Server Setup

Before using the extension, you need to set up a backend server to handle authentication. Here's a simple Node.js/Express example:

```javascript
// server.js
const express = require('express');
const fetch = require('node-fetch');
const app = express();
app.use(express.json());

const CIRCLE_AUTH_TOKEN = process.env.CIRCLE_AUTH_TOKEN; // From Circle admin

app.post('/auth', async (req, res) => {
  const { email } = req.body;
  if (!email) return res.status(400).json({ error: 'Email required' });

  try {
    const response = await fetch('https://app.circle.so/api/v1/headless/auth_token', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${CIRCLE_AUTH_TOKEN}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ email })
    });
    
    const data = await response.json();
    if (data.access_token) {
      res.json({ access_token: data.access_token });
    } else {
      res.status(400).json({ error: data.error || 'Failed to generate token' });
    }
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(process.env.PORT || 3000, () => console.log('Server running'));
```

Deploy this to a service like Vercel, Heroku, or your own server.

### 2. Configure the Extension

1. Right-click the extension icon and select "Options"
2. Enter your Circle community email
3. Enter your backend URL (e.g., `https://your-backend.vercel.app/auth`)
4. Click "Authenticate"

### 3. Get Your Space ID

To find your Circle Space ID:
1. Go to your Circle community
2. Navigate to the space where you want to post
3. The Space ID is in the URL: `https://app.circle.so/spaces/{SPACE_ID}/...`

## How to Use

1. **Basic Clipping**:
   - Navigate to any webpage
   - Select text or click on media you want to clip
   - Click the PathUnfold icon in your browser toolbar
   - Edit the content if needed
   - Enter your Space ID
   - Click "Post to Circle"

2. **Context Menu** (Optional):
   - Right-click on selected content, images, or media
   - Select "Clip to Circle" from the context menu
   - The extension popup will open with pre-filled content

## Supported Content Types

### Text
- Selected text is automatically captured
- Page title and meta description are used as fallback
- Text is wrapped in `<p>` tags for proper formatting

### Images
- Automatically detects images in selected content
- Falls back to Open Graph image or main page image
- Images are embedded with `<img>` tags

### Videos & Audio
- Supports YouTube, Vimeo, Dailymotion embeds
- Native HTML5 video and audio elements
- Media URLs are placed in separate `<p>` tags to trigger Circle's oEmbed

## Security Features

- Access tokens are stored locally in Chrome storage
- Tokens expire after 1 hour for security
- No Circle API tokens are exposed in the frontend
- Backend server handles secure token generation

## Troubleshooting

### Common Issues

1. **"Not authenticated" error**:
   - Check your backend server is running
   - Verify your CIRCLE_AUTH_TOKEN is correct
   - Re-authenticate in extension options

2. **"Token expired" message**:
   - Access tokens expire after 1 hour
   - Simply re-authenticate in options

3. **"Space not found" error**:
   - Verify your Space ID is correct
   - Ensure you have posting permissions in that space

4. **Media not embedding**:
   - Circle handles oEmbed automatically
   - Ensure media URLs are on their own line in the content

### Debug Mode

To enable debug logging:
1. Open Chrome DevTools
2. Go to the extensions background page (`chrome://extensions/ > Service Worker`)
3. Check the console for error messages

## Development

### Project Structure
```
pathunfold-web-clipper/
├── manifest.json       # Extension manifest
├── content.js         # Content script for capturing data
├── popup.html/js      # Extension popup UI
├── options.html/js    # Settings page
├── background.js      # Background service worker
├── icons/             # Extension icons
└── README.md          # This file
```

### Building for Production

1. Ensure all files are properly minified (optional)
2. Update version in manifest.json
3. Create ZIP file for Chrome Web Store upload
4. Test thoroughly before publishing

## API Reference

### Circle Headless Member API

#### Authentication
- **Endpoint**: `POST /api/v1/headless/auth_token`
- **Headers**: `Authorization: Bearer {CIRCLE_AUTH_TOKEN}`
- **Body**: `{ "email": "user@example.com" }`

#### Create Post
- **Endpoint**: `POST /api/v1/headless/posts`
- **Headers**: `Authorization: Bearer {access_token}`
- **Body**: 
  ```json
  {
    "space_id": "your-space-id",
    "name": "Post Title",
    "body": "HTML content",
    "post_type": "basic"
  }
  ```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## License

This project is licensed under the MIT License.

## Support

For issues and questions:
- Create an issue in the repository
- Check the troubleshooting section above
- Review Circle's Headless API documentation